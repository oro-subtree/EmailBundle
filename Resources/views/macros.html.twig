{% macro renderAvailableVariablesWidget(entityName, dependentFieldId) %}
    <script type="text/javascript">
        $(function() {
            'use strict';

            var availableVariables = {{ render(path('oro_api_get_emailtemplate_available_variables', { 'entityName': entityName }))}};

            new Oro.Email.VariablesUpdater.View({
                el:         $('#oro-email-available-variables'),
                template:   $('#available-variables-lists-template'),
                target:     $('#{{ dependentFieldId }}'),
                model:      new Oro.Email.VariablesUpdater.Variable(availableVariables)
            });
        })
    </script>

    <script type="text/template" id="available-variables-lists-template">
        <% if (userVars.length > 0) { %>
        <div>
            <h4>{{ 'Logged in user:'|trans }}</h4>
            <ul class="nav nav-list">
                <% _.each(userVars, function(variable, i) { %>
                    <li><a href="javascript:void(0);">{% verbatim %}{{ user.<%= variable %> }}{% endverbatim %}</a></li>
                <% }); %>
            </ul>
        </div>
        <% } %>
        <% if (entityVars.length > 0) { %>
        <div>
            <h4>{{ 'Related entity:'|trans }}</h4>
            <ul class="nav nav-list">
                <% _.each(entityVars, function(variable, i) { %>
                    <li><a href="javascript:void(0);">{% verbatim %}{{ entity.<%= variable %> }}{% endverbatim %}</a></li>
                <% }); %>
            </ul>
        </div>
        <% } %>
    </script>

    <div class="well well-small span5" id="oro-email-available-variables"></div>
{% endmacro %}

{% macro renderPreviewDialog(title) %}
    <script type="text/javascript">
        $(function () {
            var showEmailPreviewDialog = function (el) {
                var iframe = $('<iframe frameborder="0" marginwidth="0" marginheight="0" allowfullscreen width="100%"></iframe>');
                iframe.attr({'src': $(el).attr('href')});

                new Oro.widget.DialogView({
                    el: $('<div/>').append(iframe),
                    url: false,
                    dialogOptions: {
                        allowMaximize: true,
                        allowMinimize: true,
                        dblclick: 'maximize',
                        maximizedHeightDecreaseBy: 'minimize-bar',
                        width: 600,
                        title: {{ title|json_encode|raw }}
                    }
                }).render();
            };

            $('.dialog-form-renderer').click(function (e) {
                showEmailPreviewDialog(this);
                e.preventDefault();
            });
        });
    </script>
{% endmacro %}
