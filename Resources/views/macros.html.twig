{% macro email_address(emailAddress, emailAddressName, nameFormat, itemFormat) -%}
    {% macro email_address_link(emailAddress, emailAddressName, nameFormat) -%}
        {#- TODO: we need EntityConfig to get view url for an entity -#}
        <a href="{{ path(emailAddress.owner.class|split('\\')|first|lower ~ '_' ~ emailAddress.owner.class|split('\\')|last|lower ~ '_view', {id:emailAddress.owner.id}) }}">{{ emailAddress.owner.fullname(nameFormat)|default('N/A')|raw }}</a>
    {%- endmacro -%}
    {% if emailAddress.owner is null -%}
        {{ itemFormat|default('%s')|format(emailAddressName)|raw }}
    {%- else -%}
        {{ itemFormat|default('%s')|format(_self.email_address_link(emailAddress, emailAddressName, nameFormat))|raw }}
    {%- endif %}
{%- endmacro %}

{% macro recipient_email_addresses(recipients, nameFormat, itemFormat) -%}
    {% set addreses = {} -%}
    {% for recipient in recipients -%}
        {{ _self.email_address(recipient.emailAddress, recipient.name, nameFormat, itemFormat) }}
        {%- if not loop.last %}; {% endif %}
    {%- endfor %}
{%- endmacro %}
