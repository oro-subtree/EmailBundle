{% import "OroEmailBundle::actions.html.twig" as Actions %}
{% import 'OroUIBundle::macros.html.twig' as UI %}
{% import 'OroEmailBundle::macros.html.twig' as EA %}

<div class="widget-content thread-view">
    <div>
    {% for email in thread|reverse %}
    <div class="email-info">
        <div class="email-short">
            <div class="pull-right">
                <div class="email-sent-date">
                    {% if email.emailBody.hasAttachments %}
                    <i class="icon-paper-clip email-has-attachment"></i>
                    {% endif %}
                    {{ EA.email_sent_at(email) }}
                </div>
            </div>
            <div class="email-participants">
                <span class="email-author">{{ EA.email_participant_name_or_me(email.fromEmailAddress, email.fromName, true) }}</span>
                <span class="email-recipients">{{ 'To'|trans|lower }} {{ EA.email_participants_name(email.recipients, true, false) }}</span>
            </div>
            <div class="email-body">
                {# @todo output short email body #}
                Twig 1.17.0 has just been released. It contains a new “dynamic” autoescaping strategy, named ‘filename’.
            </div>
        </div>
        <div class="email-full">
            <div class="pull-right">
                <div class="email-sent-date">
                {% if email.emailBody.hasAttachments %}
                    <i class="icon-paper-clip email-has-attachment"></i>
                {% endif %}
                {{ EA.email_sent_at(email) }}<br />
                </div>
                {% set buttonsHtml %}
                    {{ Actions.replyButton(email) }}
                    {{ Actions.forwardButton(email) }}
                {% endset %}
                {{ UI.pinnedDropdownButton({
                    'html': buttonsHtml
                }) }}
            </div>
            <div class="email-participants">
                <div class="email-author">{{ EA.email_participant_name_or_me(email.fromEmailAddress, email.fromName, true) }}</div>
                <span class="email-recipients">{{ 'To'|trans }}: {{ EA.email_participants_name(email.recipients, true) }}</span>
                <div class="email-detailed-info-table dropdown">
                    <span class="dropdown-toggle" data-toggle="dropdown" title="{{ 'oro.email.show_details.tooltip'|trans }}">
                        <i class="fa fa-chevron-down"></i>
                    </span>
                    <div class="dropdown-menu" role="menu">
                        {{ EA.email_detailed_info_table(email) }}
                    </div>
                </div>
            </div>
            <div class="email-body">
                {% if email.emailBody %}
                    {{ email.emailBody.bodyContent|raw }}
                {% else %}
                    {{ 'oro.email.body_is_unavailable'|trans }}
                {% endif %}
            </div>
            {% if email.emailBody.hasAttachments %}
                {{ UI.attibuteRow('Attachments'|trans, EA.attachments(email.emailBody.attachments)) }}
            {% endif %}
        </div>
    </div>
    {% endfor %}
    </div>


{#    <div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">
        {% for email in thread %}
            <div id="{{ email.id }}" class="panel panel-default">
                <div class="panel-heading email-head" role="tab" id="heading{{ loop.index }}">
                    <div class="panel-title pull-left">
                        <a class="subject" data-toggle="collapse" data-parent="#accordion"
                           href="#collapse{{ loop.index }}" aria-expanded="false" aria-controls="collapse{{ loop.index }}">
                            {{ email.subject }}
                        </a>
                        <div class="clearfix"></div>
                        <span class="recipients">{{ 'To'|trans }}: {{ EA.recipient_email_addresses(email.toCc, false, false) }}</span>
                        <br/>
                        <span class="sentAt">{{ email.sentAt|oro_format_datetime }}</span>
                    </div>
                    <div class="pull-right">
                        <div class="btn-group">
                            {{ Actions.replyButton(email) }}
                            {{ Actions.forwardButton(email) }}
                        </div>
                    </div>
                </div>
                <div id="collapse{{ loop.index }}"
                     class="panel-collapse collapse {{ loop.last ? 'in' : '' }} email-body"
                     role="tabpanel" aria-labelledby="heading{{ loop.index }}">
                    <div class="panel-body email-body">
                        {% if email.emailBody %}
                            {{ email.emailBody.bodyContent|raw }}
                        {% else %}
                            {{ 'oro.email.body_is_unavailable'|trans }}
                        {% endif %}
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>#}
</div>
