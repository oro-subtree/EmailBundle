{% set entityClass = 'Oro\\Bundle\\EmailBundle\\Entity\\Email' %}
{% set entityName = oro_entity_config_value(entityClass, 'label')|trans %}
<script type="text/html" id="{{ id|e('html_attr')|raw }}">
    <div class="accordion-group">
        <div class="accordion-heading collapse<% if (!collapsed) { %> in<% } %>">
            <div class="title-item">
                <a href="#accordion-item<%= id %>" class="no-hash accordion-toggle<% if (collapsed) { %> collapsed<% } %>"></a>
                <span class="icon">
                    <i class="{{ oro_entity_config_value(entityClass, 'icon')|raw }}"></i>
                </span>
                <span class="visual">
                    <span class="details">
                        {{ entityName }}
                        <% var template = {{ 'oro.email.sent_by.label'|trans|json_encode|raw }}; %>
                        <%= _.template(
                            template,
                            {
                                user: '<a class="user" href="' + owner_url + '">' +  _.escape(owner) + '</a>',
                                date: '<i class="date">' + updatedAt + '</i>'
                            },
                            { interpolate: /\{\{(.+?)\}\}/g }
                        ) %>
                    </span>
                    <span class="message-item message">
                        <a href="#" class="no-hash accordion-toggle"><%= subject %></a>
                    </span>
                </span>
            </div>
            <div class="actions">
                <button class="btn item-remove-button<% if (!removable) { %> disabled<% } %>" <% if (!removable) { %> disabled="disabled"<% } %>
                    title="{{ 'oro.email.delete_email'|trans({'{{ entity }}': entityName})|e('html_attr')|raw }}">
                    <i class="icon-trash hide-text">{{ 'oro.email.delete_email'|trans({'{{ entity }}': entityName})|e('html')|raw }}</i>
                </button>
            </div>
        </div>
        <div class="accordion-body collapse<% if (!collapsed) { %> in<% } %>" id="accordion-item<%= id %>">
            <div class="subject">
                <a href="#" class="no-hash accordion-toggle"><%= subject %></a>
            </div>
            <div class="message">
                <% if (data != null) {
                    var dateTimeFormatter = require('orolocale/js/formatter/datetime');
                    var routing = require('routing');
                    var templateEmail = '<div class="control-group">' +
                        '<label class="control-label">[[ label ]]</label>' +
                        '<div class="controls">' +
                            '<div class="control-label">[[ value ]]</div>' +
                            '</div>' +
                        '</div>';
                    var iframeTemplate = '<iframe sandbox="" class="email-body" src="[[ src ]]"></iframe>';
                    var preTagTemplate = '<pre class="email-body">[[ content ]]</pre>';
                %>

                    <%= _.template(templateEmail,
                        {label: '{{ 'From'|trans|raw }}', value: data['from']},
                        {interpolate: /\[\[(.+?)\]\]/g}
                    ) %>

                    <%= _.template(templateEmail,
                    {
                        label: '{{ 'oro.email.sent_at.label'|trans|raw }}',
                        value: dateTimeFormatter.formatDateTime(data['sent_at'])
                    },
                        {interpolate: /\[\[(.+?)\]\]/g}
                    ) %>

                    <% if (data['is_body_as_text'] == 1) { %>
                        <%= _.template(preTagTemplate,
                            {content: data['body_content']},
                            {interpolate: /\[\[(.+?)\]\]/g})
                        %>
                    <% } else { %>
                        <%= _.template(iframeTemplate,
                            {src: routing.generate('oro_email_body', {'id': data['body_id']})},
                            {interpolate: /\[\[(.+?)\]\]/g})
                        %>
                    <% } %>
                <% } %>
            </div>
        </div>
    </div>
</script>
